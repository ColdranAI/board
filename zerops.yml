zerops:
  - setup: app
    build:
      base: nodejs@22
      envVariables:
        DATABASE_URL: ${RUNTIME_DATABASE_URL}
        NEXT_PUBLIC_BETTER_AUTH_URL: ${RUNTIME_NEXT_PUBLIC_BETTER_AUTH_URL}
        BETTER_AUTH_SECRET: ${RUNTIME_BETTER_AUTH_SECRET}
        GOOGLE_CLIENT_ID: ${RUNTIME_GOOGLE_CLIENT_ID}
        GOOGLE_CLIENT_SECRET: ${RUNTIME_GOOGLE_CLIENT_SECRET}
        GITHUB_CLIENT_ID: ${RUNTIME_GITHUB_CLIENT_ID}
        GITHUB_CLIENT_SECRET: ${RUNTIME_GITHUB_CLIENT_SECRET}
        EMAIL_FROM: ${RUNTIME_EMAIL_FROM}
        AUTH_RESEND_KEY: ${RUNTIME_AUTH_RESEND_KEY}
        NODE_ENV: production
      buildCommands:
        - pnpm i
        - pnpm run build
      cache:
      - pnpm-lock.yaml
      - node_modules
      deployFiles: ./
    run:
      base: nodejs@22
      initCommands:
        - pnpm run db:migrate
      envVariables:
        DATABASE_URL: ${db_connectionTlsString}/${db_dbName}
        NEXT_PUBLIC_BETTER_AUTH_URL: https://board.coldran.com
      ports:
        - port: 3000
          httpSupport: true
      start: pnpm start
